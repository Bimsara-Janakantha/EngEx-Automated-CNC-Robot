<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CNC Web Controller</title>
<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="css/w3-theme.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"></script>
<script src="js/jquery-1.9.0.min.js"></script>

<style>
/* Flex layout */
body, html {
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    height: 100%;
}
.main-container {
    display: flex;
    height: 100vh;
}

/* Left visualizer panel */
.visualizer-panel {
    flex: 7;
    padding: 10px;
    position: relative; /* for floating panel */
}

/* Right sidebar with all controls */
.sidebar {
    flex: 3;
    background: #f5f5f5;
    border-left: 1px solid #ccc;
    padding: 10px;
    overflow-y: auto;
}

/* Canvas */
#visualizerCanvas {
    width: 100%;
    height: auto;
    border: 1px solid gray;
    border-radius: 5px;
}

/* Floating Coordinates Panel */
#coordPanel {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: rgba(255,255,255,0.85);
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-weight: bold;
    z-index: 10;
    font-family: Arial, sans-serif;
    font-size: 14px;
}

/* Accordions */
.app-accordian-title {
    background-color: #f0f0f0;
    color: #333;
    border: 1px solid #ccc;
    text-align: left;
    font-weight: bold;
    padding: 10px 15px;
    cursor: pointer;
    margin-bottom:5px;
}
.app-accordian-title:hover {
    background-color: #ddd;
}
.w3-accordion-content {
    padding: 10px 5px;
}

/* Buttons */
.app-panel-btn {
    border: 1px solid #555;
    height: 45px;
    width: 45px;
    padding: 5px;
    margin: 3px;
    background-color: #f8f8f8;
    transition: background-color 0.2s, transform 0.1s;
}
.app-panel-btn:hover {
    background-color: #ccc !important;
    transform: scale(1.05);
}
.app-panel-fake-btn {
    border: 0;
    height: 45px;
    width: 45px;
    padding: 5px;
    margin: 3px;
    background-color: transparent;
}

/* Sliders */
.slidecontainer { width:100%; margin:10px 0; }
.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 12px;
    border-radius: 6px;
    background: #e0e0e0;
    outline: none;
    opacity: 0.9;
    transition: opacity 0.3s;
}
.slider:hover { opacity:1; }
.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #4288da;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 0 3px rgba(0,0,0,0.5);
}
.slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #4288da;
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 0 3px rgba(0,0,0,0.5);
}

/* Drag & Drop Zone */
#dropZone {
    border-radius:5px;
    padding:10px;
    text-align:center;
    cursor:pointer;
    border:2px dashed gray;
    transition: background-color 0.2s, border-color 0.2s;
}
#dropZone.w3-light-gray {
    background-color: #f0f0f0;
    border-color: #aaa;
}
</style>
</head>
<body>

<div class="main-container">

  <!-- LEFT: Visualizer -->
  <div class="visualizer-panel">
    <!-- Floating Coordinates Panel -->
    <div id="coordPanel">
      X: <span id="coordX">0.00</span> |
      Y: <span id="coordY">0.00</span> |
      Z: <span id="coordZ">0.00</span>
    </div>

    <div class="w3-card-4">
      <div class="w3-container w3-light-grey">
        <h5><i class="fa fa-eye"></i> Visualizer</h5>
      </div>
      <div class="w3-container w3-center">
        <canvas id="visualizerCanvas" width="800" height="600"></canvas>
        <br>
        <button class="w3-btn w3-blue w3-small" onclick="clearCanvas()">Clear</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: Controls Sidebar -->
  <div class="sidebar">

    <!-- Coordinates -->
    <div class="w3-card-4">
      <p><strong>Work Coordinates:</strong><br>
        X: <span id="lblXCord">0.00</span> | 
        Y: <span id="lblYCord">0.00</span> | 
        Z: <span id="lblZCord">0.00</span>
      </p>
      <p><strong>Status:</strong> <span id="lblSatus">Not Connected</span></p>
      <div class="w3-btn-group">
        <button id="btnHome" class="w3-btn w3-light-grey fa fa-home"></button>
        <button id="btnUnlock" class="w3-btn w3-light-grey fa fa-unlock"></button>
        <button id="btnUpdate" class="w3-btn w3-light-grey fa fa-question"></button>
        <button id="btnReset" class="w3-btn w3-light-grey fa fa-refresh"></button>
        <button id="btnResetZero" class="w3-btn w3-light-grey fa fa-crosshairs"></button>
      </div>
    </div>

    <!-- Controller -->
    <div class="w3-card-4">
      <button onclick="accordianHandler('accController')" class="app-accordian-title">Controller</button>
      <div id="accController" class="w3-accordion-content">
        <div class="w3-btn-group">
          <button id="btnStart" class="w3-btn w3-green fa fa-play"> Start</button>
          <button id="btnPause" class="w3-btn w3-amber fa fa-pause"> Pause</button>
          <button id="btnStop" class="w3-btn w3-red fa fa-stop"> Stop</button>
        </div>
      </div>
    </div>

    <!-- Commands -->
    <div class="w3-card-4">
      <button onclick="accordianHandler('accCommands')" class="app-accordian-title">Commands</button>
      <div id="accCommands" class="w3-accordion-content">
        <label>Type command:</label>
        <input id="commandInput" class="w3-input w3-border" type="text" placeholder="Enter command...">
        <br>
        <label>Upload/Drop Image:</label>
        <div id="dropZone">Drop image here or click</div>
        <input type="file" id="fileUpload" accept="image/*" style="display:none;">
      </div>
    </div>

    <!-- Jog Control -->
<div class="w3-card-4">
  <button onclick="accordianHandler('accJog')" class="app-accordian-title">Jog Control</button>
  <div id="accJog" class="w3-accordion-content">
    
    <!-- XY Jog Panel -->
    <h5 style="text-align:center; margin:5px 0;">XY</h5>
    <table style="margin:auto;">
      <tr>
        <td></td>
        <td><button class="app-panel-btn fa fa-arrow-up" onclick="jog('Y+')"></button></td>
        <td></td>
      </tr>
      <tr>
        <td><button class="app-panel-btn fa fa-arrow-left" onclick="jog('X-')"></button></td>
        <td><button class="app-panel-btn fa fa-stop" onclick="jog('STOP')"></button></td>
        <td><button class="app-panel-btn fa fa-arrow-right" onclick="jog('X+')"></button></td>
      </tr>
      <tr>
        <td></td>
        <td><button class="app-panel-btn fa fa-arrow-down" onclick="jog('Y-')"></button></td>
        <td></td>
      </tr>
    </table>
    
    <hr style="margin:10px 0;">
    
    <!-- Z Jog Panel -->
    <h5 style="text-align:center; margin:5px 0;">Z</h5>
    <table style="margin:auto;">
      <tr>
        <td><button class="app-panel-btn fa fa-arrow-up" onclick="jog('Z+')"></button></td>
      </tr>
      <tr>
        <td><button class="app-panel-btn fa fa-arrow-down" onclick="jog('Z-')"></button></td>
      </tr>
    </table>
    
  </div>
</div>


  </div>
</div>

<script>
function accordianHandler(id){
  const elem = document.getElementById(id);
  elem.classList.toggle("w3-show");
  elem.previousElementSibling.classList.toggle("w3-gray");
}

function clearCanvas(){
  let ctx = document.getElementById("visualizerCanvas").getContext("2d");
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
}

function jog(dir){
  console.log("Jog command:", dir);
  // sendCommand logic here
}

// Update floating coordinates panel
function updateCoordinates(x, y, z){
  document.getElementById("coordX").textContent = x.toFixed(2);
  document.getElementById("coordY").textContent = y.toFixed(2);
  document.getElementById("coordZ").textContent = z.toFixed(2);
}


</script>

</body>
</html>
